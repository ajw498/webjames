<?
if ($picture) {
	#We are being called to generate the picture
	Header("Content-type: image/png");
	$im = imagecreate(300,300); #Create a blank image
	$green = imagecolorallocate($im,0,255,0); #Declare the colours we will use
	$red = imagecolorallocate($im,255,0,0);
	$blue = imagecolorallocate($im,0,0,255);
	$black = imagecolorallocate($im,0,0,0);
	$white = imagecolorallocate($im,255,255,255);
	imagefill($im,150,150,$white); #Set the background colour
	for ($i=0;$HTTP_GET_VARS["x".$i];$i++) { #Find all shapes we need to plot
		switch ($HTTP_GET_VARS["s".$i]) {
			case 3: #Triangle
				imagefilledpolygon($im,array($HTTP_GET_VARS["x".$i]-20,$HTTP_GET_VARS["y".$i]+20,$HTTP_GET_VARS["x".$i]+20,$HTTP_GET_VARS["y".$i]+20,$HTTP_GET_VARS["x".$i],$HTTP_GET_VARS["y".$i]-20),3,$red);
				break;
			case 2: #Circle
				imagearc($im,$HTTP_GET_VARS["x".$i],$HTTP_GET_VARS["y".$i],40,40,0,360,$green);
				imagefilltoborder($im,$HTTP_GET_VARS["x".$i],$HTTP_GET_VARS["y".$i],$green,$green);
				break;
			default: #Square
				imagefilledrectangle($im,$HTTP_GET_VARS["x".$i]-20,$HTTP_GET_VARS["y".$i]-20,$HTTP_GET_VARS["x".$i]+20,$HTTP_GET_VARS["y".$i]+20,$blue);
		}
	}
	imagestring($im,4,220,285,date("d/m/Y"),$black); #Add the date to the bottom right corner
	imagepng($im); #Create the GIF
	imagedestroy($im); #Free the memory
} else {
#We are being called to generate the HTML bit of the page?>
<html><head><title>
PHP Example
</title></head><body>
<h1>WebArt</h1>
<P>Select the shape you want to draw, then click on the image to add it. The PHP script can cope with any number of shapes being added, but as the length of URLs are limited then it only works up to about ten shapes.
<P>There is one PHP script that generates both this HTML and the image.
<P><FORM ACTION="<? echo $PHP_SELF ?>" METHOD="GET">
<INPUT TYPE=radio NAME="shape" VALUE="1" checked>Square<br>
<INPUT TYPE=radio NAME="shape" VALUE="2">Circle<br>
<INPUT TYPE=radio NAME="shape" VALUE="3">Triangle<br>
<? #Add hidden items to store coordinates of all the shapes added so far
for ($i=0;$HTTP_GET_VARS["x".$i];$i++) {
	printf("<INPUT TYPE=hidden NAME=\"%s\" VALUE=\"%d\">\n","x".$i,$HTTP_GET_VARS["x".$i]);
	printf("<INPUT TYPE=hidden NAME=\"%s\" VALUE=\"%d\">\n","y".$i,$HTTP_GET_VARS["y".$i]);
	printf("<INPUT TYPE=hidden NAME=\"%s\" VALUE=\"%d\">\n","s".$i,$HTTP_GET_VARS["s".$i]);
}
if ($sub_x) { #Add the new shape
	printf("<INPUT TYPE=hidden NAME=\"%s\" VALUE=\"%d\">\n","x".$i,$sub_x);
	printf("<INPUT TYPE=hidden NAME=\"%s\" VALUE=\"%d\">\n","y".$i,$sub_y);
	printf("<INPUT TYPE=hidden NAME=\"%s\" VALUE=\"%d\">\n","s".$i,$shape);
}
echo "<INPUT TYPE=image src=\"$PHP_SELF?picture=1";
for ($i=0;$HTTP_GET_VARS["x".$i];$i++) { #Add parameters to use when fetching the picture
	printf("&%s=%d","x".$i,$HTTP_GET_VARS["x".$i]);
	printf("&%s=%d","y".$i,$HTTP_GET_VARS["y".$i]);
	printf("&%s=%d","s".$i,$HTTP_GET_VARS["s".$i]);
}
if ($sub_x) { #Add parameters for the shape just created
	printf("&%s=%d","x".$i,$sub_x);
	printf("&%s=%d","y".$i,$sub_y);
	printf("&%s=%d","s".$i,$shape);
}
echo '" width=300 height=300 name="sub">';
?>
</FORM><BR>
<A HREF="<? echo $PHP_SELF ?>">Clear picture</A><BR>
<A HREF="./">Back</A>
</BODY></HTML>
<? } ?>

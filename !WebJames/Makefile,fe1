
# Makefile for WebJames the web server

CC            = MemCheck.cc cc

# possible flags:
# ANTRESOLVER     use the ANT resolver module API for reverse DNS
# LOG             enable logging
# SYSLOG          use SysLog instead of internal log
# CASESENSITIVE   use case-sensitive filename matching

#CCFlags       = -c -throwback -IC: -IOSLib: -DANTRESOLVER -DLOG -DSYSLOG -Otime
#CCFlags       = -c -throwback -IC: -fah -IOSLib: -DLOG -DSYSLOG -Otime
#CCFlags       = -c -throwback -IC: -fah -IOSLib: -DLOG -Otime
CCFlags       = -c -throwback -IC: -g -fah -IOSLib: -DLOG
LinkFlags     = -o $@

Libs          = OSLib:o.OSLib C:o.Stubs C:o.socklib MemCheck:o.MC
Objects       = main.o webjames.o ip.o stat.o report.o write.o openclose.o \
                read.o cache.o coding.o mimemap.o attributes.o cgi.o \
                resolve.o cacheheap.o

!RunImage:    $(Objects)
              Link -d $(Linkflags) $(Objects) $(Libs)
#              Squeeze -f -v !WebJames.!RunImage

.c.o:
	$(CC) $(CCFlags) $< -o $@

# Dynamic dependencies:
main.o:       main.c global.h webjames.h
webjames.o:   webjames.c webjames.h global.h ip.h stat.h report.h write.h \
              openclose.h read.h attributes.h cache.h resolve.h
stat.o:       stat.c webjames.h stat.h ip.h
report.o:     report.c report.h webjames.h ip.h stat.h cache.h write.h \
              openclose.h
write.o:      write.c write.h webjames.h ip.h stat.h report.h \
              cache.h openclose.h attributes.h cgi.h mimemap.h
openclose.o:  openclose.c openclose.h webjames.h ip.h stat.h cache.h cgi.h \
              resolve.h
read.o:       read.c read.h webjames.h ip.h report.h write.h \
              stat.h coding.h cgi.h attributes.h
ip.o:         ip.c ip.h
cache.o:      cache.c cache.h webjames.h stat.h mimemap.h write.h cacheheap.h
coding.o:     coding.c coding.h
mimemap.o:    mimemap.c mimemap.h
attributes.o: attributes.c attributes.h cgi.h stat.h webjames.h
cgi.o:        cgi.c cgi.h openclose.h report.h webjames.h stat.h ip.h
resolve.o:    resolve.c resolve.h webjames.h ip.h stat.h
cacheheap.o:  cacheheap.c cacheheap.h
